package font

import (
	"fmt"
	"testing"

	"github.com/tdewolff/test"
)

func TestWOFF2Error(t *testing.T) {
	var tts = []struct {
		data string
		err  string
	}{
		{"wOF200000000\x00\x00000000\xff\xff\xff\xff000000000000000000000000", "length in header must match file size"},
		{"wOF200000000\x00\x00000000\x00\x00\x00\b00000000000000000000000030000000", "length in header must match file size"},
		{"wOF200000000\x00\x01000000\x00\x00\x000000000000000000000000000Y\xbf\x00\x00Z\x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000", "length in header must match file size"},
		{"wOF2OTTO\x00\x00\x03\xd4\x00\t\x00\x00\xff\x01\a@" +
			"\x00\x00\x03\x8d\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" +
			"\x00\x00\x00\x00\x00\x00\x00\x00\x18\x84.\x06`\x00\x81f\x016\x02$" +
			"\x03\x10\x04\x06\x1f\x85\x17\a \x1b\x9a\x06Q\xd4\xc4\xc0\t\x00\xfcL" +
			"\xb0\xc1=tE8\x8e2X\x96\x9aQl\x87Il\xc2\r\xeb\xb1" +
			"\xe6\x89\xfc\x12\x0f_K\xf7\xfe\xee\x1d\xad5\x8dlՁ*\xd5\t" +
			"T4\x83\xd08d\xc6G\xb9\xa8(\xd0l\xaci\x8a\x96\xcf\xc7\x16" +
			"Y\xb6\x9f\"I~F\xe1g\xd4\xe6\xdc\xee\xfd\xaeb\xb2b\xcfB" +
			"Ɓ\xfe\xa2U\xe9W\xb3\x87\x16^\xfa4\"\x98\xf8M\\s\x99" +
			"\x04_ \x03\x8e2\x8d\x0e\xdc\xcd\"\xca\x13l\xd3\x015\xe0l\xad" +
			"\x89c\x98\x89l\x18\xbb\xe8\x01\x1e\x16\x8aBD\f\xdc\xee\x89.\xac" +
			"\xed\x94\xc1aa\xb670\x92\x17\xbb\x9b!S\x14a\xdabLG" +
			"\x9c\xe9J|\x9f\xa1+\xa2e%?D@Jq\tۧ\x02\x8a" +
			"ʄD\xc4\xd0|\xa9\x16z\xa4:\xa4tl,\xa0\xbc\aѭ" +
			"\x00\"\b\xcbZ\x92IH\xb2\xe7\xf6\xafPP0\xe5\xb7\b\xb6\x83" +
			",\x81|\xba\x03\x93\x85S\x14+\xf9\x04\x82G(iz\xa5\xb0Q" +
			"\x00\x830\x01\x93\xe0\x86N\x9a\x9d\xbf\x1b<\x84k\xa9\x0eu*\xbe" +
			"\x8ac\xcb!\x02w\xb1\x958X>酖\x136>!\xfb\x8f" +
			"\xaa\xc20\xcc\xe0\xcec\aA9\xaa`\xc0\xf4\xe0\x1c\a\xb6/\x9f" +
			"\x82$H\xba>E[}<\xd4\xf3n\xdaɡ\a\x8e.7\x83" +
			"\xfd\x94\x97\xc3\xfd\\\x0fl]\x1e!\x89\xf3\xf90ҟ\xc6z\xe1" +
			"[\x12f\xe5\xd6'h\x8f\xf5\xc0\x92\xe5\x8d4B\ruk\x93\xfe" +
			">\x90\"\xd0C\x1fb#a\x9f\xf9h\xae~`l\xb4\xb75\u007f" +
			"\x97\xaf6*9\x04\x19\xda\x1c\x8f\x06\xf38}PIߖ\xef\xa3" +
			"啒\xe9e\xe2v\x13|\xba\xf4zp\xder\xban\xce\xd2\xe5" +
			"\xab\x0e\xec(\xfb\xaa\r\x82\xf7OA\xeaY\xf5U\f\xbc\xa3\x8fr" +
			"G\xab\xf6\xddֺu\xec\xc8ӷW\xecQv\xa9\xderh\xa3" +
			"\xff\u007fa1\x87\xb2Y\x1bkAO&\xf2\x94~>\x12\x83\xb2\xfa" +
			"p\xe5\x04\a\"x\x96`#\xd5!3Y~[\x1c\xab0c\x06" +
			"\xe5\x87\xd4t\x1d\x00\xd0\xfa>\b\xc9\xf2/*J\xd2G\xba\x03\xce" +
			"\xd3\xcbĽv\x1b\x02\xee ?g\xef+c'\xcc8ܷQ" +
			"r\x9d\x19\x10\x10\xbf\xa9\x81\x19\x80\x8c\x8c\t1p!!0!i" +
			"\ah\xd1\"a\x069lV\n9^\xee\xc8v\v\xb5M>\xd1" +
			"\xea$\xff\xc8\x01J>`\x05$\xcanzLp\xf0O\x82G\xc6" +
			"\xe7\xaf%\xe7:\xd4t5\xfe\x005\xc3ѳ/h\xf9J\rd" +
			"\t\x04\xfd\xcf\xd7ڪ\fҷ9\xd2\x17\xd5\xc8cyY\xf6\x87" +
			"\xf5\xd9{\x03\nt\xf9\x16<\xd4I6\x904\xeb\x04\xb2)\xc5\xfe" +
			"\xa2<\xa0t\xa2\r4\xe9\x17%Z\f\xf9\xe9\x1ev\xd1\x1a\x1a\xf3" +
			"\x9b\r$]\xaa@\xb6\xef\x1f(,\xd5\f\x94*m\xf67\x15[" +
			"l\xb1Quơ\x9a\x99\xe8[/\xa3\xa18\x1d\xb5ռJ\xb5" +
			"M\xa5,3y8c\xb3\x999+\xe8\xce{T\xc8\v\xc6\xeb\xbd" +
			"\xc1d\x9e)͋\xe0\xea\x8a\xf8nϷ[\xc3Q\xef\xbfȶ" +
			"\xaa}\xf4ξ\x89\xb8\x1c\xfb\x99\xea\x8ay\xfc\x87\xe1n\x8f\x10t" +
			"\xc1\xb29\xd0\x14!',\x9eK\xf1bi\xa9kjj\x9a\xd8\xd1" +
			"iX\x93:\xa8\x98\x8a\r\xa9\xc1n\x94Yzò\xd8\xc4&\f" +
			"bS\x13\ag\x98\xddX$U\xa0s|\xaa\xb1x\\\x1a\xfbz" +
			"\x066U\xf5\"c\xcb\xdbǩS\x88\xde\xda\xe0\x87kk\x19\x1a" +
			"\xe9A3\x8c\x1b\xc6\xc6\xde\xc1\x16c\xe7\xe2\x8e\xf5Ft\x1a\x87\r" +
			"\xdd\xe9,2\x91\x86\x87\xe6,:\x97!\x01\xfc\xff\xd8\x13\x00\x00\x00", "memory limit exceded"},
	}
	for i, tt := range tts {
		t.Run(fmt.Sprintf("%d", i), func(t *testing.T) {
			_, err := ParseWOFF2([]byte(tt.data))
			if err != nil {
				test.T(t, err.Error(), tt.err)
			} else {
				test.T(t, "", tt.err)
			}
		})
	}
}
